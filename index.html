<!--
=========================================
  Secure Homework Portal - Full Stack
  Author: Code Generator GPT
  Usage: Split frontend and backend
=========================================
-->

<!-- ================= FRONTEND HTML ================= -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Homework Portal</title>
  <style>
    body { font-family: sans-serif; background: #f2f2f2; padding: 20px; }
    h1, h2 { color: #333; }
    .container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; }
    input, textarea, select, button {
      width: 100%; padding: 10px; margin-top: 10px; margin-bottom: 20px;
    }
    button { background: #4361ee; color: #fff; border: none; cursor: pointer; }
    button:hover { background: #364fc7; }
    .lesson { background: #e9ecef; padding: 10px; margin: 10px 0; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ“š Secure Homework Portal</h1>

    <!-- AUTH SECTION -->
    <div id="auth">
      <h2>Login/Register</h2>
      <input id="username" placeholder="Username" />
      <input id="password" type="password" placeholder="Password" />
      <select id="role">
        <option value="student">Student</option>
        <option value="teacher">Teacher</option>
      </select>
      <button onclick="register()">Register</button>
      <button onclick="login()">Login</button>
    </div>

    <!-- UPLOAD SECTION (Visible only to teachers) -->
    <div id="uploadSection" style="display:none;">
      <h2>Upload Lesson</h2>
      <input id="lessonTitle" placeholder="Lesson Title" />
      <textarea id="lessonDesc" placeholder="Description"></textarea>
      <select id="lessonGrade">
        <option value="">Select Grade</option>
        <script>for(let i=1;i<=9;i++)document.write(`<option value="grade${i}">Grade ${i}</option>`);</script>
      </select>
      <input type="file" id="lessonFile" />
      <button onclick="uploadLesson()">Upload</button>
    </div>

    <!-- LESSON VIEWER -->
    <div>
      <h2>View Lessons</h2>
      <select id="gradeSelect" onchange="loadLessons()">
        <option value="">Select Grade</option>
        <script>for(let i=1;i<=9;i++)document.write(`<option value="grade${i}">Grade ${i}</option>`);</script>
      </select>
      <div id="lessonList"></div>
    </div>
  </div>

  <script>
    let currentUser = null;

    async function register() {
      const res = await fetch("/api/auth/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          username: username.value,
          password: password.value,
          role: role.value
        })
      });
      const data = await res.json();
      alert(data.success ? "Registered successfully!" : data.error);
    }

    async function login() {
      const res = await fetch("/api/auth/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          username: username.value,
          password: password.value
        })
      });
      const data = await res.json();
      if (data.success) {
        currentUser = data.user;
        alert("Login successful!");
        auth.style.display = "none";
        if (currentUser.role === "teacher") {
          uploadSection.style.display = "block";
        }
      } else {
        alert("Login failed");
      }
    }

    async function uploadLesson() {
      const formData = new FormData();
      formData.append("title", lessonTitle.value);
      formData.append("description", lessonDesc.value);
      formData.append("grade", lessonGrade.value);
      formData.append("file", lessonFile.files[0]);

      const res = await fetch("/api/lessons/upload", {
        method: "POST",
        body: formData
      });
      const data = await res.json();
      alert(data.success ? "Lesson uploaded!" : "Upload failed");
    }

    async function loadLessons() {
      const grade = gradeSelect.value;
      const res = await fetch(`/api/lessons/${grade}`);
      const lessons = await res.json();
      lessonList.innerHTML = lessons.map(lesson => `
        <div class="lesson">
          <h3>${lesson.title}</h3>
          <p>${lesson.description}</p>
          <a href="/uploads/${lesson.file}" target="_blank">Download</a>
        </div>
      `).join('');
    }
  </script>
</body>
</html>

<!-- ================== BACKEND (Node.js) ================== -->
<!-- Paste this part into `server.js` for backend server -->

<!--
const express = require('express');
const session = require('express-session');
const mongoose = require('mongoose');
const multer = require('multer');
const bcrypt = require('bcrypt');
const cors = require('cors');
const path = require('path');

const app = express();
require('dotenv').config();

mongoose.connect('mongodb://localhost:27017/homeworkPortal');

const User = mongoose.model('User', new mongoose.Schema({
  username: String,
  password: String,
  role: String
}));

const Lesson = mongoose.model('Lesson', new mongoose.Schema({
  title: String,
  description: String,
  grade: String,
  file: String,
  uploadedBy: mongoose.Schema.Types.ObjectId
}));

app.use(cors());
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
app.use(session({ secret: 'mySecret', resave: false, saveUninitialized: true }));
app.use('/uploads', express.static(path.join(__dirname, 'public/uploads')));
app.use(express.static('public'));

const storage = multer.diskStorage({
  destination: (req, file, cb) => cb(null, 'public/uploads'),
  filename: (req, file, cb) => cb(null, `${Date.now()}-${file.originalname}`)
});
const upload = multer({ storage });

// Register
app.post('/api/auth/register', async (req, res) => {
  const { username, password, role } = req.body;
  try {
    const hash = await bcrypt.hash(password, 10);
    await new User({ username, password: hash, role }).save();
    res.json({ success: true });
  } catch {
    res.status(400).json({ error: 'Username already taken' });
  }
});

// Login
app.post('/api/auth/login', async (req, res) => {
  const user = await User.findOne({ username: req.body.username });
  if (user && await bcrypt.compare(req.body.password, user.password)) {
    req.session.user = user;
    res.json({ success: true, user: { username: user.username, role: user.role } });
  } else {
    res.status(401).json({ error: 'Invalid credentials' });
  }
});

// Upload Lesson
app.post('/api/lessons/upload', upload.single('file'), async (req, res) => {
  if (!req.session.user || req.session.user.role !== 'teacher') return res.status(403).json({ error: 'Unauthorized' });
  const lesson = new Lesson({
    title: req.body.title,
    description: req.body.description,
    grade: req.body.grade,
    file: req.file.filename,
    uploadedBy: req.session.user._id
  });
  await lesson.save();
  res.json({ success: true });
});

// Fetch lessons by grade
app.get('/api/lessons/:grade', async (req, res) => {
  const lessons = await Lesson.find({ grade: req.params.grade });
  res.json(lessons);
});

// Start server
app.listen(process.env.PORT || 3000, () => console.log('Server running on port 3000'));
-->